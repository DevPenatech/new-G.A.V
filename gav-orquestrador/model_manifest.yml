# O Manifesto do Modelo define o comportamento do G.A.V. de forma declarativa.
# O Orquestrador irá carregar este ficheiro para saber como agir.

versao_manifesto: 1.0

# Regras de roteamento são executadas em ordem. A primeira que corresponder é executada.
roteamento:
  # Regra 0: Bypass para Saudações. É uma ação determinística e rápida.
  - nome: "Saudação Simples (Bypass)"
    bypass_llm: true
    condicoes:
      - tipo: regex
        # Regex mais específica para evitar falsos positivos com "adicionar ao carrinho"
        padrao: '^\s*(ver|mostrar|exibir|meu)?\s*carrinh[oa]s?\b'
    acao:
      tool_name: "emitir_resposta"
      parametros: { "mensagem": "Olá! Como posso te ajudar hoje?" }

  # Regra 1: Bypass para ver o carrinho. É uma ação determinística.
  - nome: "Verificar Carrinho (Bypass)"
    bypass_llm: true
    condicoes:
      - tipo: regex
        padrao: '\b(carrinh[oa]s?|ver carrinho|meu carrinho|mostrar carrinho|exibir carrinho)\b'
    acao:
      tool_name: "ver_carrinho"

  # Regra 2: Bypass para escolha de item. Ação baseada no estado da conversa.
  - nome: "Extrair Escolha de Item (Memória)"
    bypass_llm: true
    condicoes:
      - tipo: estado_sessao
        estado: "aguardando_escolha_item"
    acao:
      # 'handler' indica uma função específica no código, não uma ferramenta.
      handler: "extrair_escolha_do_contexto"

  # Regra 3: Rota Padrão com IA (Master Prompt)
  # Esta é a regra que usamos para todas as buscas de produto.
  - nome: "Análise de Intenção e Extração de Parâmetros com IA"
    bypass_llm: false
    acao:
      tipo: "extracao_parametros_llm"
      prompt: "prompt_mestre"